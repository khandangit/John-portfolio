---
layout: layouts/base.njk
title: Gallery
permalink: "/gallery/"
---
<section class="wrap gallery-page">
  <header class="gallery-header">
    <h1>Gallery</h1>
    <p class="lead">Browse selected works. Use search or sort to find pieces quickly.</p>

    <div class="gallery-toolbar" role="region" aria-label="Gallery controls">
      <input id="gallery-search" class="input" type="search" placeholder="Search by title, year, tag…" aria-label="Search artworks">
      <div class="toolbar-right">
        <label class="select">
          <span>Sort</span>
          <select id="gallery-sort" aria-label="Sort artworks">
            <option value="new">Newest first</option>
            <option value="old">Oldest first</option>
            <option value="az">Title A–Z</option>
            <option value="za">Title Z–A</option>
          </select>
        </label>
        <button id="layout-toggle" class="btn btn-ghost" type="button" aria-pressed="false">Large view</button>
      </div>
    </div>
  </header>

  <div id="gallery-grid" class="grid pro" data-layout="grid" aria-live="polite">
    {% for item in collections.artworks %}
      {% set alt = item.data.title or 'Artwork' %}
      {% set title = item.data.title or 'Untitled' %}
      {% set year = item.data.year or '' %}
      {% set tags = item.data.tags or [] %}

      <a
        class="card pro"
        href="{{ item.url }}"
        data-title="{{ title | lower }}"
        data-year="{{ year }}"
        data-tags="{{ tags | join(' ') | lower }}"
        aria-label="{{ title }}{% if year %} ({{ year }}){% endif %}"
      >
        <div class="thumb">
          {% if item.data.image %}
            {% cimg item.data.image, alt, "(min-width: 1100px) 22vw, (min-width: 768px) 33vw, 100vw" %}
          {% else %}
            <div class="placeholder"></div>
          {% endif %}
        </div>
        <div class="meta">
          <h3 class="title">{{ title }}</h3>
          <p class="sub">
            {% if year %}{{ year }}{% endif %}
            {% if tags and year %} • {% endif %}
            {% if tags %}{{ tags | join(", ") }}{% endif %}
          </p>
        </div>
      </a>
    {% endfor %}
  </div>

  <p id="gallery-empty" class="muted" hidden>No artworks match your search.</p>
</section>

<script>
// Inline gallery controls (search + sort + layout)
(function () {
  const grid = document.getElementById('gallery-grid');
  if (!grid) return;

  const cards = Array.from(grid.querySelectorAll('.card.pro'));
  const searchInput = document.getElementById('gallery-search');
  const sortSelect  = document.getElementById('gallery-sort');
  const layoutBtn   = document.getElementById('layout-toggle');
  const emptyMsg    = document.getElementById('gallery-empty');

  function normalizeYear(y) {
    const n = parseInt(String(y || '').trim(), 10);
    return Number.isFinite(n) ? n : -Infinity;
  }

  function applySearch() {
    const q = (searchInput?.value || '').trim().toLowerCase();
    let visible = 0;
    cards.forEach(card => {
      const hay = (card.dataset.title + ' ' + card.dataset.tags + ' ' + card.dataset.year).toLowerCase();
      const show = !q || hay.includes(q);
      card.style.display = show ? '' : 'none';
      if (show) visible++;
    });
    if (emptyMsg) emptyMsg.hidden = visible !== 0;
  }

  function applySort() {
    const mode = sortSelect?.value || 'new';
    let cmp;
    if (mode === 'new') cmp = (a,b) => normalizeYear(b.dataset.year) - normalizeYear(a.dataset.year);
    else if (mode === 'old') cmp = (a,b) => normalizeYear(a.dataset.year) - normalizeYear(b.dataset.year);
    else if (mode === 'az')  cmp = (a,b) => a.dataset.title.localeCompare(b.dataset.title);
    else if (mode === 'za')  cmp = (a,b) => b.dataset.title.localeCompare(a.dataset.title);
    else cmp = () => 0;

    cards.sort(cmp).forEach(el => grid.appendChild(el));
  }

  function toggleLayout() {
    const isLarge = grid.getAttribute('data-layout') === 'large';
    grid.setAttribute('data-layout', isLarge ? 'grid' : 'large');
    if (layoutBtn) {
      layoutBtn.textContent = isLarge ? 'Large view' : 'Grid view';
      layoutBtn.setAttribute('aria-pressed', String(!isLarge));
    }
  }

  searchInput?.addEventListener('input', applySearch);
  sortSelect?.addEventListener('change', () => { applySort(); applySearch(); });
  layoutBtn?.addEventListener('click', toggleLayout);

  applySort();
  applySearch();
})();
</script>
